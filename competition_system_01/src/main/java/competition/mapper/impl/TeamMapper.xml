<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="competition.mapper.TeamMapper">
<!-- 
//	TeamCode
	public void addTeamCode(TeamCode teamCode);
	public void removeTeamCode(int teamCodeId);
	public void modifyTeamCode(TeamCode teamCode);
	public TeamCode getTeamCode(int teamCodeId);
	public List<TeamCode> findTeamCodes(String learderId);
	
	
//	Team
	public void addTeam(Team team);
	public void removeTeam(int teamId);
	public void modifyTeam(Team team);
	public TeamView getTeam(int teamId);
	public List<TeamView> findTeams(int teamCodeId);
 -->
	<insert id="addTeamCode"  parameterType="competition.domain.code.TeamCode" useGeneratedKeys="true" keyProperty="teamCodeId">
		insert into teamcode_db(leaderId,
		teamName, boardCodeId, teamType, teamContent)
		values(#{leaderId}, #{teamName}, #{boardCodeId}, #{teamType}, #{teamContent})
	</insert>

	<update id="modifyTeamCode" parameterType="competition.domain.code.TeamCode">
		update teamcode_db
		set leaderId = #{leaderId},
		teamName = #{teamName},
		teamType = #{teamType},
		teamContent = #{teamContent}
		where teamCodeId = #{teamCodeId}
	</update>
 
	<delete id="removeTeamCode" parameterType="int">
		delete from teamcode_db
		where
		teamCodeId = #{teamCodeId}
	</delete>

	<select id="getTeamCode" resultType="competition.domain.view.code.TeamCodeView">
		select *
		from teamcode_db
		where teamCodeId = #{teamCodeId}
	</select>

	<select id="findTeamCodes" resultType="competition.domain.view.code.TeamCodeView">
		select *
		from teamcode_db
		where boardCodeId = #{boardCodeId}
	</select>

	<select id="findRanks" resultType="competition.domain.Rank">
		select t1.teamCodeId id, teamName name, sum(score) sum, avg(score) average
		from teamcode_db t1 join score_db s1
		on t1.teamCodeId = s1.teamCodeId
		where t1.boardCodeId = #{boardCodeId}
		group by t1.teamCodeId
		order by sum desc
	</select>

	<insert id="addTeam" parameterType="competition.domain.view.TeamView">
		insert into team_db(teamId,
		teamCodeId, userId)
		values(#{teamId},
		#{teamCodeId}, #{userId})
	</insert>

	<delete id="removeTeam" parameterType="int">
		delete from team_db
		where
		teamId = #{teamId}
	</delete>

	<select id="getTeam" resultType="competition.domain.view.TeamView">
		select teamId, teamCodeId,
		t1.userId userId
		from team_db t1 join user_db u1
		on t1.userId = u1.userId
		where teamId =
		#{teamId}
	</select>

	<select id="findTeams" resultType="competition.domain.view.TeamView">
		select teamId, teamCodeId,
		t1.userId userId
		from team_db t1 join user_db u1
		on t1.userId = u1.userId
		where teamCodeId =
		#{teamCodeId}
	</select>
</mapper> 
